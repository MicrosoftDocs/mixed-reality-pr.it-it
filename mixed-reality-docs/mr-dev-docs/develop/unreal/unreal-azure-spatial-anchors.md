---
title: Ancoraggi nello spazio di Azure in Unreal
description: Informazioni su come creare, gestire e individuare gli ancoraggi nello spazio di Azure esistenti nelle applicazioni di realtà mista Unreal.
author: hferrone
ms.author: jacksonf
ms.date: 12/9/2020
ms.topic: tutorial
ms.localizationpriority: high
keywords: Unreal, Unreal Engine 4, UE4, HoloLens 2, azure, sviluppo di azure, ancoraggi nello spazio, realtà mista, sviluppo, funzionalità, nuovo progetto, emulatore, documentazione, guide, ologrammi, sviluppo di giochi, visore VR realtà mista, visore VR di windows mixed reality, visore per realtà virtuale
ms.openlocfilehash: 01d7217f038519d68eabfbf4f273c7ff8cbe7193
ms.sourcegitcommit: 029f247a6c33068360d3a06f2a473a12586017e1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/14/2021
ms.locfileid: "100496195"
---
# <a name="azure-spatial-anchors-in-unreal"></a><span data-ttu-id="f26c0-104">Ancoraggi nello spazio di Azure in Unreal</span><span class="sxs-lookup"><span data-stu-id="f26c0-104">Azure Spatial Anchors in Unreal</span></span>

<span data-ttu-id="f26c0-105">Ancoraggi nello spazio di Azure è un servizio di Realtà mista di Microsoft che consente ai dispositivi di realtà aumentata di individuare, condividere e salvare in modo permanente i punti di ancoraggio nel mondo fisico.</span><span class="sxs-lookup"><span data-stu-id="f26c0-105">Azure Spatial Anchors is a Microsoft Mixed Reality service, allowing augmented reality devices to discover, share, and persist anchor points in the physical world.</span></span> <span data-ttu-id="f26c0-106">La documentazione seguente fornisce istruzioni utili per l'integrazione del servizio Ancoraggi nello spazio di Azure in un progetto Unreal.</span><span class="sxs-lookup"><span data-stu-id="f26c0-106">Documentation below provides instructions for integrating the Azure Spatial Anchors service into an Unreal project.</span></span> <span data-ttu-id="f26c0-107">Per altre informazioni, vedere il [servizio Ancoraggi nello spazio di Azure](https://azure.microsoft.com/services/spatial-anchors/).</span><span class="sxs-lookup"><span data-stu-id="f26c0-107">If you're looking for more information, check out the [Azure Spatial Anchors service](https://azure.microsoft.com/services/spatial-anchors/).</span></span>

> [!NOTE]
> <span data-ttu-id="f26c0-108">Unreal Engine 4.26 è ora dotato di plug-in per il supporto di ARKit e ARCore nel caso in cui la destinazione sia un dispositivo iOS o Android.</span><span class="sxs-lookup"><span data-stu-id="f26c0-108">Unreal Engine 4.26 now has plugins for ARKit and ARCore support if you're targeting iOS or Android.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f26c0-109">Gli ancoraggi locali vengono archiviati nel dispositivo, mentre i dati relativi ad Ancoraggi nello spazio di Azure vengono archiviati nel cloud.</span><span class="sxs-lookup"><span data-stu-id="f26c0-109">Local anchors are stored on device, while Azure Spatial Anchors are stored in the cloud.</span></span> <span data-ttu-id="f26c0-110">Se si vuole archiviare gli ancoraggi in locale in un dispositivo, è disponibile il documento [Ancoraggi nello spazio locali](unreal-spatial-anchors.md) che fornisce informazioni dettagliate per l'esecuzione del processo.</span><span class="sxs-lookup"><span data-stu-id="f26c0-110">If you're looking to store your anchors locally on a device, we have a [Local Spatial Anchors](unreal-spatial-anchors.md) document that can walk you through the process.</span></span> <span data-ttu-id="f26c0-111">Si noti che è possibile includere ancoraggi locali e ancoraggi di Azure nello stesso progetto senza che si verifichino conflitti.</span><span class="sxs-lookup"><span data-stu-id="f26c0-111">Note that you can have local and Azure anchors in the same project without conflict.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="f26c0-112">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="f26c0-112">Prerequisites</span></span>

<span data-ttu-id="f26c0-113">Per completare le procedure contenute in questa guida, verificare che siano soddisfatti i requisti seguenti:</span><span class="sxs-lookup"><span data-stu-id="f26c0-113">To complete this guide, make sure you have:</span></span>

- <span data-ttu-id="f26c0-114">Installato [Unreal versione 4.25](https://www.unrealengine.com/get-now) o successiva</span><span class="sxs-lookup"><span data-stu-id="f26c0-114">Installed [Unreal version 4.25](https://www.unrealengine.com/get-now) or later</span></span>
- <span data-ttu-id="f26c0-115">[Progetto HoloLens 2](tutorials/unreal-uxt-ch1.md) configurato in Unreal</span><span class="sxs-lookup"><span data-stu-id="f26c0-115">A [HoloLens 2 project](tutorials/unreal-uxt-ch1.md) setup in Unreal</span></span> 
- <span data-ttu-id="f26c0-116">Leggere la sezione [Panoramica di Ancoraggi nello spazio di Azure](/azure/spatial-anchors/overview)</span><span class="sxs-lookup"><span data-stu-id="f26c0-116">Read through the [Azure Spatial Anchors overview](/azure/spatial-anchors/overview)</span></span>
- <span data-ttu-id="f26c0-117">Nozioni di base su C++ e Unreal</span><span class="sxs-lookup"><span data-stu-id="f26c0-117">Basic knowledge on C++ and Unreal</span></span>

## <a name="getting-azure-spatial-anchors-account-info"></a><span data-ttu-id="f26c0-118">Recupero delle informazioni sull'account di Ancoraggi nello spazio di Azure</span><span class="sxs-lookup"><span data-stu-id="f26c0-118">Getting Azure Spatial Anchors account info</span></span>

<span data-ttu-id="f26c0-119">Prima di usare Ancoraggi nello spazio di Azure nel progetto, è necessario:</span><span class="sxs-lookup"><span data-stu-id="f26c0-119">Before using Azure Spatial Anchors in your project, you need to:</span></span>
* <span data-ttu-id="f26c0-120">[Creare una risorsa di Ancoraggi nello spazio](/azure/spatial-anchors/quickstarts/get-started-hololens#create-a-spatial-anchors-resource) e copiare i campi dell'account elencati di seguito.</span><span class="sxs-lookup"><span data-stu-id="f26c0-120">[Create a spatial anchors resource](/azure/spatial-anchors/quickstarts/get-started-hololens#create-a-spatial-anchors-resource) and copy the account fields listed below.</span></span> <span data-ttu-id="f26c0-121">Questi valori vengono usati per autenticare gli utenti con l'account dell'applicazione:</span><span class="sxs-lookup"><span data-stu-id="f26c0-121">These values are used to authenticate users with your application's account:</span></span>
    * <span data-ttu-id="f26c0-122">**ID account**</span><span class="sxs-lookup"><span data-stu-id="f26c0-122">**Account ID**</span></span>
    * <span data-ttu-id="f26c0-123">**Chiave dell'account**</span><span class="sxs-lookup"><span data-stu-id="f26c0-123">**Account Key**</span></span>

<span data-ttu-id="f26c0-124">Per altre informazioni, vedere la documentazione relativa all'[autenticazione di Ancoraggi nello spazio di Azure](/azure/spatial-anchors/concepts/authentication?tabs=csharp).</span><span class="sxs-lookup"><span data-stu-id="f26c0-124">Check out the [Azure Spatial Anchors authentication](/azure/spatial-anchors/concepts/authentication?tabs=csharp) docs for more information.</span></span>

> [!NOTE]
> <span data-ttu-id="f26c0-125">Ancoraggi nello spazio di Azure in Unreal 4.25 non supporta i token di autenticazione di Azure AD. Il supporto per questa funzionalità, tuttavia, sarà disponibile in una versione successiva.</span><span class="sxs-lookup"><span data-stu-id="f26c0-125">Azure Spatial Anchors in Unreal 4.25 does not support Azure AD authentication tokens, but support for this functionality will be coming in a later release.</span></span>

## <a name="enabling-internet-access"></a><span data-ttu-id="f26c0-126">Abilitazione dell'accesso a Internet</span><span class="sxs-lookup"><span data-stu-id="f26c0-126">Enabling Internet access</span></span>

<span data-ttu-id="f26c0-127">Aprire **Impostazioni progetto > HoloLens** e abilitare la funzionalità **client Internet** :</span><span class="sxs-lookup"><span data-stu-id="f26c0-127">Open **Project Settings > HoloLens** and enable the **Internet Client** capability:</span></span>

![Impostazioni del progetto HoloLens con funzionalità evidenziate](images/asa-enable-wifi-connection.jpg)

## <a name="adding-azure-spatial-anchors-plugins"></a><span data-ttu-id="f26c0-129">Aggiunta di plug-in di Ancoraggi nello spazio di Azure</span><span class="sxs-lookup"><span data-stu-id="f26c0-129">Adding Azure Spatial Anchors plugins</span></span>

<span data-ttu-id="f26c0-130">Abilitare i plug-in di Ancoraggi nello spazio di Azure nell'editor Unreal nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="f26c0-130">Enable the Azure Spatial Anchors plugins in the Unreal editor by:</span></span>
1. <span data-ttu-id="f26c0-131">Fare clic su **Edit > Plugins** (Modifica > Plug-in) e cercare **AzureSpatialAnchors** e **AzureSpatialAnchorsForWMR**.</span><span class="sxs-lookup"><span data-stu-id="f26c0-131">Clicking **Edit > Plugins** and searching for **AzureSpatialAnchors** and **AzureSpatialAnchorsForWMR**.</span></span>
2. <span data-ttu-id="f26c0-132">Selezionare la casella di controllo **Enabled** (Abilitato) di entrambi i plug-in per consentire l'accesso alle librerie del progetto di Ancoraggi nello spazio di Azure nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f26c0-132">Select the **Enabled** checkbox in both plugins to allow access to the Azure Spatial Anchors blueprint libraries in your application.</span></span>

![Screenshot dei plug-in di Ancoraggi nello spazio nell'editor di Unreal](images/asa-unreal/unreal-spatial-anchors-img-01.png)

<span data-ttu-id="f26c0-134">Al termine, riavviare l'editor Unreal per rendere effettive le modifiche apportate ai plug-in.</span><span class="sxs-lookup"><span data-stu-id="f26c0-134">Once that's done, restart the Unreal Editor for the plugin changes to take effect.</span></span> <span data-ttu-id="f26c0-135">Il progetto è ora pronto per l'uso di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-135">The project is now ready to use Azure Spatial Anchors.</span></span>

## <a name="starting-a-spatial-anchors-session"></a><span data-ttu-id="f26c0-136">Avvio di una sessione di Ancoraggi nello spazio</span><span class="sxs-lookup"><span data-stu-id="f26c0-136">Starting a Spatial Anchors session</span></span>

<span data-ttu-id="f26c0-137">Una sessione di Ancoraggi nello spazio di Azure consente alle applicazioni client di comunicare con il servizio Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-137">An Azure Spatial Anchors session allows client applications to communicate with the Azure Spatial Anchors service.</span></span> <span data-ttu-id="f26c0-138">È necessario creare e avviare una sessione di Ancoraggi nello spazio di Azure per creare, salvare in modo permanente e condividere Ancoraggi nello spazio di Azure:</span><span class="sxs-lookup"><span data-stu-id="f26c0-138">You'll need to create and start an Azure Spatial Anchors session to create, persist, and share Azure Spatial Anchors:</span></span>

1. <span data-ttu-id="f26c0-139">Aprire il progetto per il pedone che si sta usando nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f26c0-139">Open the blueprint for the Pawn you're using in the application.</span></span>
2. <span data-ttu-id="f26c0-140">Aggiungere due variabili di stringa per **ID account** e **Chiave dell'account** e quindi assegnare i valori corrispondenti dell'account di Ancoraggi nello spazio di Azure per eseguire l'autenticazione della sessione.</span><span class="sxs-lookup"><span data-stu-id="f26c0-140">Add two string variables for the **Account ID** and **Account Key**, then assign the corresponding values from your Azure Spatial Anchors account to authenticate the session.</span></span>

![Screenshot del riquadro dei dettagli con l'ID e la chiave dell'account di Ancoraggi nello spazio di Azure e il tipo di variabile evidenziati](images/asa-unreal/unreal-spatial-anchors-img-02.png)

<span data-ttu-id="f26c0-142">Avviare una sessione di Ancoraggi nello spazio di Azure nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="f26c0-142">Start an Azure Spatial Anchors session by:</span></span>
1. <span data-ttu-id="f26c0-143">Verificare che nell'applicazione HoloLens sia in esecuzione un'istanza di **AR Session** (Sessione AR) poiché la sessione di Ancoraggi nello spazio di Azure non può essere avviata fino a quando non è in esecuzione una sessione AR.</span><span class="sxs-lookup"><span data-stu-id="f26c0-143">Checking that an **AR Session** is running in the HoloLens application, as the Azure Spatial Anchors session can't start until an AR Session is running.</span></span> <span data-ttu-id="f26c0-144">[Creare un asset di sessione AR](/windows/mixed-reality/unreal-uxt-ch3#adding-the-session-asset) se non ne è stato configurato nessuno.</span><span class="sxs-lookup"><span data-stu-id="f26c0-144">If you don't have one setup, [create an AR Session asset](/windows/mixed-reality/unreal-uxt-ch3#adding-the-session-asset).</span></span>
2. <span data-ttu-id="f26c0-145">Aggiungere l'evento personalizzato **Start Azure Spatial Anchors Session** (Avvia sessione di Ancoraggi nello spazio di Azure) e configurarlo nel modo illustrato nello screenshot seguente.</span><span class="sxs-lookup"><span data-stu-id="f26c0-145">Adding the **Start Azure Spatial Anchors Session** custom event and configure it as shown in the screenshot below.</span></span>
    * <span data-ttu-id="f26c0-146">La creazione di una sessione non determina l'avvio della sessione per impostazione predefinita, che consente di configurare la sessione per l'autenticazione con il servizio Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-146">Creating a session doesn't start the session by default, which allows you to configure the session for authentication with the Azure Spatial Anchors service.</span></span>

![Progetto dell'evento personalizzato di avvio della sessione di Ancoraggi nello spazio di Azure](images/asa-unreal/unreal-spatial-anchors-img-03.png)

3. <span data-ttu-id="f26c0-148">Configurare la sessione di Ancoraggi nello spazio di Azure per specificare **ID account** e **Chiave dell'account**.</span><span class="sxs-lookup"><span data-stu-id="f26c0-148">Configure the Azure Spatial Anchors session to provide the **Account ID** and **Account Key**.</span></span>

![Progetto della funzione di configurazione della sessione con ID e chiave dell'account aggiunti](images/asa-unreal/unreal-spatial-anchors-img-04.png)

4. <span data-ttu-id="f26c0-150">Avviare la sessione di Ancoraggi nello spazio di Azure, consentendo all'applicazione di creare e individuare Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-150">Start the Azure Spatial Anchors session, allowing the application to create and locate Azure Spatial Anchors.</span></span>

![Progetto della funzione di avvio della sessione di Ancoraggi nello spazio di Azure](images/asa-unreal/unreal-spatial-anchors-img-05.png)

<span data-ttu-id="f26c0-152">Quando non si usa più il servizio, è consigliabile pulire le risorse di Ancoraggi nello spazio di Azure presenti nel progetto Event Graph (Grafico eventi):</span><span class="sxs-lookup"><span data-stu-id="f26c0-152">It's good practice to clean up Azure Spatial Anchors resources in your Event Graph blueprint when you're no longer using the service:</span></span>

1. <span data-ttu-id="f26c0-153">Arrestare la sessione di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-153">Stop the Azure Spatial Anchors session.</span></span> <span data-ttu-id="f26c0-154">La sessione non sarà più in esecuzione, ma le risorse associate saranno ancora presenti nel plug-in di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-154">The session will no longer be running, but its associated resources will still exist in the Azure Spatial Anchors plugin.</span></span>

![Progetto dell'evento personalizzato di arresto della sessione di Ancoraggi nello spazio di Azure e della funzione di arresto della sessione](images/asa-unreal/unreal-spatial-anchors-img-06.png)

2. <span data-ttu-id="f26c0-156">Eliminare la sessione di Ancoraggi nello spazio di Azure per eseguire la pulizia di tutte le risorse della sessione ancora note al plug-in di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-156">Destroy the Azure Spatial Anchors session to clean up any Azure Spatial Anchors session resources still known to the Azure Spatial Anchors plugin.</span></span>

![Progetto della funzione di eliminazione della sessione](images/asa-unreal/unreal-spatial-anchors-img-07.png)

<span data-ttu-id="f26c0-158">Il progetto Event Graph (Grafico eventi) dovrebbe avere un aspetto simile allo screenshot seguente:</span><span class="sxs-lookup"><span data-stu-id="f26c0-158">Your Event Graph blueprint should look like the screenshot below:</span></span>

![Progetto del grafico eventi completo per la configurazione della sessione di Ancoraggi nello spazio di Azure](images/asa-unreal/unreal-spatial-anchors-img-08.png)

## <a name="creating-an-anchor"></a><span data-ttu-id="f26c0-160">Creazione di un ancoraggio</span><span class="sxs-lookup"><span data-stu-id="f26c0-160">Creating an anchor</span></span>

<span data-ttu-id="f26c0-161">Un ancoraggio nello spazio di Azure rappresenta una posa del mondo fisico nello spazio dell'applicazione di realtà aumentata, che blocca il contenuto della realtà aumentata nelle posizioni fisiche.</span><span class="sxs-lookup"><span data-stu-id="f26c0-161">An Azure Spatial Anchor represents a physical world pose in the augmented reality application space, which locks augmented reality content to physical locations.</span></span> <span data-ttu-id="f26c0-162">È anche possibile condividere Ancoraggi nello spazio di Azure tra diversi utenti.</span><span class="sxs-lookup"><span data-stu-id="f26c0-162">Azure Spatial Anchors can also be shared among different users.</span></span> <span data-ttu-id="f26c0-163">Questa condivisione consente al contenuto della realtà aumentata progettato su dispositivi diversi di essere posizionato come nel mondo fisico.</span><span class="sxs-lookup"><span data-stu-id="f26c0-163">This sharing allows augmented reality content drawn on different devices to be positioned in the same location in the physical world.</span></span> 

<span data-ttu-id="f26c0-164">Per creare un nuovo ancoraggio nello spazio di Azure:</span><span class="sxs-lookup"><span data-stu-id="f26c0-164">To create a new Azure Spatial Anchor:</span></span>
1. <span data-ttu-id="f26c0-165">Verificare che sia in esecuzione una sessione di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-165">Check that an Azure Spatial Anchors session is running.</span></span> <span data-ttu-id="f26c0-166">L'applicazione non può creare o salvare in modo permanente un ancoraggio nello spazio di Azure quando non è in esecuzione alcuna sessione di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-166">The application can't create or persist an Azure Spatial Anchor when no Azure Spatial Anchors session is running.</span></span>

![Progetto dell'evento personalizzato di creazione dell'ancoraggio nello spazio di Azure](images/asa-unreal/unreal-spatial-anchors-img-09.png)

2. <span data-ttu-id="f26c0-168">Creare oppure ottenere un **[componente scena](https://docs.unrealengine.com/API/Runtime/Engine/Components/USceneComponent/index.html)** di Unreal di cui deve essere salvata la posizione in modo permanente.</span><span class="sxs-lookup"><span data-stu-id="f26c0-168">Create or obtain an Unreal **[Scene Component](https://docs.unrealengine.com/API/Runtime/Engine/Components/USceneComponent/index.html)** that should have its location persisted.</span></span> 
    * <span data-ttu-id="f26c0-169">Nell'immagine seguente il componente **Scene Component Needing Anchor** (Componente scena con necessità di ancoraggio) viene usato come variabile.</span><span class="sxs-lookup"><span data-stu-id="f26c0-169">In the below image, the **Scene Component Needing Anchor** component is used as a variable.</span></span> <span data-ttu-id="f26c0-170">È necessario un componente scena Unreal per stabilire una trasformazione globale dell'applicazione per un [segnaposto AR](https://docs.unrealengine.com/BlueprintAPI/HoloLensAR/ARPin/index.html) e un ancoraggio nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-170">An Unreal Scene Component is needed to establish an application world transform for an [AR Pin](https://docs.unrealengine.com/BlueprintAPI/HoloLensAR/ARPin/index.html) and Azure Spatial Anchor.</span></span>

![Progetto dell'evento personalizzato di creazione dell'ancoraggio nello spazio di Azure con il componente scena](images/asa-unreal/unreal-spatial-anchors-img-10.png)

<span data-ttu-id="f26c0-172">Per costruire e salvare un ancoraggio nello spazio di Azure per un componente scena Unreal:</span><span class="sxs-lookup"><span data-stu-id="f26c0-172">To construct and save an Azure Spatial Anchor for an Unreal Scene Component:</span></span>
1. <span data-ttu-id="f26c0-173">Chiamare [Pin Component](https://docs.unrealengine.com/BlueprintAPI/ARAugmentedReality/Pin/PinComponent/index.html) (Componente segnaposto) per il componente scena Unreal e specificare **World Transform** (Trasformazione globale) come trasformazione globale usata per il segnaposto AR.</span><span class="sxs-lookup"><span data-stu-id="f26c0-173">Call the [Pin Component](https://docs.unrealengine.com/BlueprintAPI/ARAugmentedReality/Pin/PinComponent/index.html) for the Unreal Scene Component and specify the Scene Component's **World Transform** as the World Transform used for the AR Pin.</span></span>
    * <span data-ttu-id="f26c0-174">Unreal tiene traccia dei punti AR nello spazio dell'applicazione con i segnaposto AR, usati per creare un ancoraggio nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-174">Unreal tracks AR points in the application space using AR Pins, which are used to create an Azure Spatial Anchor.</span></span> <span data-ttu-id="f26c0-175">In Unreal un segnaposto AR è analogo a un ancoraggio nello spazio di HoloLens.</span><span class="sxs-lookup"><span data-stu-id="f26c0-175">In Unreal, an AR Pin is analogous to a SpatialAnchor on HoloLens.</span></span>

![Progetto del componente scena collegato alla funzione del componente segnaposto](images/asa-unreal/unreal-spatial-anchors-img-11.png)

2. <span data-ttu-id="f26c0-177">Chiamare **Create Cloud Anchor** (Crea ancoraggio cloud) usando il segnaposto AR appena creato.</span><span class="sxs-lookup"><span data-stu-id="f26c0-177">Call **Create Cloud Anchor** using the newly created AR Pin.</span></span>
    * <span data-ttu-id="f26c0-178">La chiamata a Create Cloud Anchor (Crea ancoraggio cloud) consente di creare un ancoraggio nello spazio di Azure in locale, ma non nel servizio Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-178">Create Cloud Anchor creates an Azure Spatial Anchor locally but not in the Azure Spatial Anchor service.</span></span> <span data-ttu-id="f26c0-179">È possibile impostare i parametri relativi all'ancoraggio nello spazio di Azure, ad esempio una data di scadenza, prima di creare l'ancoraggio nello spazio di Azure con il servizio.</span><span class="sxs-lookup"><span data-stu-id="f26c0-179">Parameters for the Azure Spatial Anchor, such as an expiration date, can be set before creating the Azure Spatial Anchor with the service.</span></span>

![Progetto della funzione del componente segnaposto collegata per creare una funzione di ancoraggio cloud che restituisca il segnaposto AR](images/asa-unreal/unreal-spatial-anchors-img-12.png)

3. <span data-ttu-id="f26c0-181">Impostare la scadenza dell'ancoraggio nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-181">Set the Azure Spatial Anchor expiration.</span></span> <span data-ttu-id="f26c0-182">Il parametro Lifetime (Durata) di questa funzione consente allo sviluppatore di specificare l'intervallo di tempo in secondi durante il quale l'ancoraggio deve essere mantenuto dal servizio.</span><span class="sxs-lookup"><span data-stu-id="f26c0-182">This function's Lifetime parameter allows the developer to specify in seconds how long the anchor should be maintained by the service.</span></span>
    * <span data-ttu-id="f26c0-183">Ad esempio, per una durata di una settimana è richiesto un valore di 60 secondi x 60 minuti x 24 ore x sette giorni = 604.800 secondi.</span><span class="sxs-lookup"><span data-stu-id="f26c0-183">For example, a week long expiration would take a value of 60 seconds x 60 minutes x 24 hours x seven days = 604,800 seconds.</span></span>

![Progetto dell'ancoraggio cloud collegato per impostare la funzione di scadenza con valore di durata pari a 604.800 secondi](images/asa-unreal/unreal-spatial-anchors-img-13.png)

<span data-ttu-id="f26c0-185">Dopo aver impostato i parametri di ancoraggio, dichiarare l'ancoraggio come pronto per il salvataggio.</span><span class="sxs-lookup"><span data-stu-id="f26c0-185">After setting anchor parameters, declare the anchor as ready to save.</span></span> <span data-ttu-id="f26c0-186">Nell'esempio seguente, l'ancoraggio nello spazio di Azure appena creato viene aggiunto a un set di ancoraggi nello spazio di Azure per i quali è necessario eseguire il salvataggio.</span><span class="sxs-lookup"><span data-stu-id="f26c0-186">In the example below, the newly created Azure Spatial Anchor is added to a set of Azure Spatial Anchors needing saving.</span></span> <span data-ttu-id="f26c0-187">Questo set viene dichiarato come variabile per il progetto Pawn.</span><span class="sxs-lookup"><span data-stu-id="f26c0-187">This set is declared as a variable for the Pawn blueprint.</span></span>

![Progetto dell'ancoraggio pronto per essere salvato nella variabile del set](images/asa-unreal/unreal-spatial-anchors-img-14.png)

## <a name="saving-an-anchor"></a><span data-ttu-id="f26c0-189">Salvataggio di un ancoraggio</span><span class="sxs-lookup"><span data-stu-id="f26c0-189">Saving an Anchor</span></span>

<span data-ttu-id="f26c0-190">Dopo aver configurato l'ancoraggio nello spazio di Azure con i parametri, chiamare **Save Cloud Anchor** (Salva ancoraggio cloud).</span><span class="sxs-lookup"><span data-stu-id="f26c0-190">After configuring the Azure Spatial Anchor with your parameters, call **Save Cloud Anchor**.</span></span> <span data-ttu-id="f26c0-191">La chiamata a Save Cloud Anchor (Salva ancoraggio cloud) dichiara l'ancoraggio al servizio Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-191">Save Cloud Anchor declares the anchor to the Azure Spatial Anchors service.</span></span> <span data-ttu-id="f26c0-192">Se la chiamata a Save Cloud Anchor (Salva ancoraggio cloud) ha esito positivo, l'ancoraggio nello spazio di Azure sarà disponibile per altri utenti del servizio Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-192">When the call to Save Cloud Anchor succeeds, the Azure Spatial Anchor is available to other users of the Azure Spatial Anchor service.</span></span>  

![Progetto della funzione di salvataggio dell'ancoraggio cloud chiamata](images/asa-unreal/unreal-spatial-anchors-img-15.png)

> [!NOTE]
> <span data-ttu-id="f26c0-194">Save Cloud Anchor (Salva ancoraggio cloud) è una funzione asincrona e può essere chiamata solo in un evento thread di gioco, ad esempio **EventTick**.</span><span class="sxs-lookup"><span data-stu-id="f26c0-194">Save Cloud Anchor is an asynchronous function and can only be called on a game thread event such as **EventTick**.</span></span> <span data-ttu-id="f26c0-195">È possibile che Save Cloud Anchor (Salva ancoraggio cloud) non venga visualizzata come funzione disponibile tra le funzioni di progetto personalizzate.</span><span class="sxs-lookup"><span data-stu-id="f26c0-195">Save Cloud Anchor may not appear as an available blueprint function in custom blueprint Functions.</span></span> <span data-ttu-id="f26c0-196">Dovrebbe essere disponibile, tuttavia, nell'editor del progetto Pawn Event Graph (Grafico eventi Pawn).</span><span class="sxs-lookup"><span data-stu-id="f26c0-196">However, it should be available in the Pawn Event Graph blueprint editor.</span></span>

<span data-ttu-id="f26c0-197">Nell'esempio seguente l'ancoraggio nello spazio di Azure viene archiviato in un set durante un callback dell'evento di input.</span><span class="sxs-lookup"><span data-stu-id="f26c0-197">In the example below, the Azure Spatial Anchor is stored in a set during an input event callback.</span></span> <span data-ttu-id="f26c0-198">L'ancoraggio viene quindi salvato in EventTick.</span><span class="sxs-lookup"><span data-stu-id="f26c0-198">The anchor is then saved on the EventTick.</span></span> <span data-ttu-id="f26c0-199">Per salvare un ancoraggio nello spazio di Azure, possono essere necessari più tentativi a seconda della quantità di dati spaziali creati dalla sessione di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-199">Saving an Azure Spatial Anchor may take multiple attempts depending on the amount of spatial data that your Azure Spatial Anchors session has created.</span></span> <span data-ttu-id="f26c0-200">Per questo motivo è consigliabile controllare se la chiamata di salvataggio ha avuto esito positivo.</span><span class="sxs-lookup"><span data-stu-id="f26c0-200">That's why it's a good idea to check whether the save call succeeded.</span></span>

<span data-ttu-id="f26c0-201">Se l'ancoraggio non viene salvato, aggiungerlo nuovamente al set di ancoraggi ancora da salvare.</span><span class="sxs-lookup"><span data-stu-id="f26c0-201">If the anchor doesn't save, readd it to the set of anchors still needing to be saved.</span></span> <span data-ttu-id="f26c0-202">EventTick futuri continueranno a provare a salvare l'ancoraggio fino a quando non viene archiviato.</span><span class="sxs-lookup"><span data-stu-id="f26c0-202">Future EventTicks will keep trying to save the anchor until it's successfully stored.</span></span>

![Progetto degli ancoraggi non salvati che vengono salvati nuovamente nella variabile del set](images/asa-unreal/unreal-spatial-anchors-img-16.png)

<span data-ttu-id="f26c0-204">Dopo il salvataggio dell'ancoraggio, la trasformazione dei segnaposto AR funge da trasformazione di riferimento per inserire contenuto nell'app.</span><span class="sxs-lookup"><span data-stu-id="f26c0-204">Once the anchor saves, the AR Pins' transform acts as a reference transform for placing content in your app.</span></span> <span data-ttu-id="f26c0-205">Altri utenti possono rilevare questo ancoraggio e allineare il contenuto AR per dispositivi diversi nel mondo fisico.</span><span class="sxs-lookup"><span data-stu-id="f26c0-205">Other users can detect this anchor and align AR content for different devices in the physical world.</span></span>

## <a name="deleting-an-anchor"></a><span data-ttu-id="f26c0-206">Eliminazione di un ancoraggio</span><span class="sxs-lookup"><span data-stu-id="f26c0-206">Deleting an Anchor</span></span>

<span data-ttu-id="f26c0-207">È possibile eliminare gli ancoraggi dal servizio Ancoraggi nello spazio di Azure chiamando **Delete Cloud Anchor** (Elimina ancoraggio cloud).</span><span class="sxs-lookup"><span data-stu-id="f26c0-207">You can delete anchors from the Azure Spatial Anchor service by calling **Delete Cloud Anchor**.</span></span>

![Progetto della funzione di eliminazione dell'ancoraggio cloud chiamata](images/asa-unreal/unreal-spatial-anchors-img-17.png)

> [!NOTE]
> <span data-ttu-id="f26c0-209">Delete Cloud Anchor (Elimina ancoraggio cloud) è una funzione latente e può essere chiamata solo nel caso di un evento thread di gioco, ad esempio EventTick.</span><span class="sxs-lookup"><span data-stu-id="f26c0-209">Delete Cloud Anchor is a latent function and can only be called on a game thread event, such as EventTick.</span></span> <span data-ttu-id="f26c0-210">È possibile che Delete Cloud Anchor (Elimina ancoraggio cloud) non venga visualizzata come funzione disponibile tra le funzioni di progetto personalizzate.</span><span class="sxs-lookup"><span data-stu-id="f26c0-210">Delete Cloud Anchor may not appear as an available blueprint function in custom blueprint Functions.</span></span> <span data-ttu-id="f26c0-211">Dovrebbe essere disponibile, tuttavia, nell'editor del progetto Pawn Event Graph (Grafico eventi Pawn).</span><span class="sxs-lookup"><span data-stu-id="f26c0-211">It should however be available in the Pawn Event Graph blueprint editor.</span></span>

<span data-ttu-id="f26c0-212">Nell'esempio seguente l'ancoraggio viene contrassegnato per l'eliminazione in un evento di input personalizzato.</span><span class="sxs-lookup"><span data-stu-id="f26c0-212">In the example below, the anchor is flagged for deletion on a custom input event.</span></span> <span data-ttu-id="f26c0-213">L'eliminazione viene quindi tentata in EventTick.</span><span class="sxs-lookup"><span data-stu-id="f26c0-213">The deletion is then attempted on the EventTick.</span></span> <span data-ttu-id="f26c0-214">Se l'eliminazione dell'ancoraggio non riesce, aggiungere l'ancoraggio nello spazio di Azure al set di ancoraggi contrassegnati per l'eliminazione e riprovare in EventTick successivi.</span><span class="sxs-lookup"><span data-stu-id="f26c0-214">If the anchor deletion fails, add the Azure Spatial Anchor to the set of anchors flagged for deletion and tries again on later EventTicks.</span></span>

<span data-ttu-id="f26c0-215">Il progetto Event Graph (Grafico eventi) dovrebbe ora avere un aspetto simile allo screenshot seguente:</span><span class="sxs-lookup"><span data-stu-id="f26c0-215">Your Event Graph blueprint should now look like the screenshot below:</span></span>

![Progetto del grafico eventi completo per la gestione di ancoraggi cloud](images/asa-unreal/unreal-spatial-anchors-img-18.png)


## <a name="locating-pre-existing-anchors"></a><span data-ttu-id="f26c0-217">Individuazione di ancoraggi preesistenti</span><span class="sxs-lookup"><span data-stu-id="f26c0-217">Locating pre-existing anchors</span></span>

<span data-ttu-id="f26c0-218">Gli ancoraggi esistenti possono essere creati da peer con il servizio Ancoraggi nello spazio di Azure:</span><span class="sxs-lookup"><span data-stu-id="f26c0-218">Existing anchors can be created by peers with the Azure Spatial Anchors service:</span></span>

1. <span data-ttu-id="f26c0-219">Ottenere un identificatore di ancoraggio nello spazio di Azure per l'ancoraggio da rilevare.</span><span class="sxs-lookup"><span data-stu-id="f26c0-219">Obtain an Azure Spatial Anchor identifier for the anchor that you would like to detect.</span></span>
    * <span data-ttu-id="f26c0-220">È possibile ottenere un identificatore per un ancoraggio creato dallo stesso dispositivo in una precedente sessione di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-220">An anchor identifier can be obtained for an anchor created by the same device in a previous Azure Spatial Anchors session.</span></span> <span data-ttu-id="f26c0-221">Può anche essere creato e condiviso da dispositivi peer che interagiscono con il servizio Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-221">It can also be created and shared by peer devices interacting with the Azure Spatial Anchors service.</span></span>

![Progetto dell'evento personalizzato di archiviazione dell'identificatore dell'ancoraggio nello spazio di Azure con la funzione per ottenere l'identificatore cloud di Azure](images/asa-unreal/unreal-spatial-anchors-img-24.png)

2. <span data-ttu-id="f26c0-223">Aggiungere un componente **AzureSpatialAnchorsEvent** al progetto Pawn.</span><span class="sxs-lookup"><span data-stu-id="f26c0-223">Add an **AzureSpatialAnchorsEvent** component to your Pawn blueprint.</span></span>
    * <span data-ttu-id="f26c0-224">Questo componente consente di effettuare la sottoscrizione a diversi eventi di Ancoraggi nello spazio di Azure, ad esempio eventi chiamati quando vengono individuati gli ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-224">This component allows you to subscribe to various Azure Spatial Anchors events, such as events called when Azure Spatial Anchors are located.</span></span>

![Screenshot di BP_Pawn aperto nell'editor di progetto con i componenti e i riquadri dei dettagli aperti](images/asa-unreal/unreal-spatial-anchors-img-19.png)

3. <span data-ttu-id="f26c0-226">Effettuare la sottoscrizione ad **ASAAnchor Located Delegate** per il componente **AzureSpatialAnchorsEvent**.</span><span class="sxs-lookup"><span data-stu-id="f26c0-226">Subscribe to the **ASAAnchor Located Delegate** for the **AzureSpatialAnchorsEvent** component.</span></span>
    * <span data-ttu-id="f26c0-227">Il delegato consente all'applicazione di stabilire quando sono stati individuati nuovi ancoraggi associati all'account di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-227">The delegate lets the application know when new anchors associated with the Azure Spatial Anchors account have been located.</span></span>
    * <span data-ttu-id="f26c0-228">Con il callback dell'evento, gli ancoraggi nello spazio di Azure creati dai peer con la sessione di Ancoraggi nello spazio di Azure non avranno segnaposto AR creati per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="f26c0-228">With the event callback, Azure Spatial Anchors created by peers using the Azure Spatial Anchors session won't have AR Pins created by default.</span></span> <span data-ttu-id="f26c0-229">Per creare un segnaposto AR per l'ancoraggio nello spazio di Azure rilevato, gli sviluppatori possono chiamare la funzione **Create ARPin Around Azure Cloud Spatial Anchor** (Crea segnaposto AR attorno all'ancoraggio nello spazio cloud di Azure).</span><span class="sxs-lookup"><span data-stu-id="f26c0-229">To create an AR Pin for the detected Azure Spatial Anchor, developers can call **Create ARPin Around Azure Cloud Spatial Anchor**.</span></span>

![Progetto dell'evento BeginPlay collegato al delegato posizionato da ASAAnchor](images/asa-unreal/unreal-spatial-anchors-img-20.png)

<span data-ttu-id="f26c0-231">Per individuare gli ancoraggi nello spazio di Azure creati da peer con il servizio Ancoraggi nello spazio di Azure, l'applicazione dovrà creare un elemento **Azure Spatial Anchors Watcher** (Watcher ancoraggi nello spazio di Azure):</span><span class="sxs-lookup"><span data-stu-id="f26c0-231">To locate Azure Spatial Anchors created by peers using the Azure Spatial Anchor service, the application will have to create an **Azure Spatial Anchors Watcher**:</span></span>
1. <span data-ttu-id="f26c0-232">Verificare che sia in esecuzione una sessione di Ancoraggi nello spazio di Azure.</span><span class="sxs-lookup"><span data-stu-id="f26c0-232">Check that an Azure Spatial Anchors session is running.</span></span>
2. <span data-ttu-id="f26c0-233">Creare **AzureSpatialAnchorsLocateCriteria**.</span><span class="sxs-lookup"><span data-stu-id="f26c0-233">Create an **AzureSpatialAnchorsLocateCriteria**.</span></span>
    * <span data-ttu-id="f26c0-234">È possibile specificare diversi parametri di posizione, ad esempio la distanza dall'utente o la distanza da un altro ancoraggio.</span><span class="sxs-lookup"><span data-stu-id="f26c0-234">You can specify various location parameters like distance from the user or distance from another anchor.</span></span>
3. <span data-ttu-id="f26c0-235">Dichiarare in **AzureSpatialAnchorsLocateCritieria** l'identificatore dell'ancoraggio nello spazio di Azure che si sta cercando.</span><span class="sxs-lookup"><span data-stu-id="f26c0-235">Declare the Azure Spatial Anchor identifier you're looking for in the **AzureSpatialAnchorsLocateCritieria**.</span></span>
4. <span data-ttu-id="f26c0-236">Chiamare **Create Watcher** (Crea Watcher).</span><span class="sxs-lookup"><span data-stu-id="f26c0-236">Call **Create Watcher**.</span></span>

![Progetto dell'evento personalizzato di avvio di Azure Spatial Anchors Watcher](images/asa-unreal/unreal-spatial-anchors-img-21.png)

<span data-ttu-id="f26c0-238">L'applicazione ora inizia a cercare gli ancoraggi nello spazio di Azure noti al servizio Ancoraggi nello spazio di Azure. In altre parole, gli utenti possono individuare gli ancoraggi nello spazio di Azure creati dai relativi peer.</span><span class="sxs-lookup"><span data-stu-id="f26c0-238">The application now begins looking for Azure Spatial Anchors known to the Azure Spatial Anchors service, meaning that users can locate Azure Spatial Anchors created by their peers.</span></span>

<span data-ttu-id="f26c0-239">Dopo aver individuato l'ancoraggio nello spazio di Azure, chiamare **Stop Watcher** (Arresta Watcher) per arrestare Azure Spatial Anchors Watcher (Watcher ancoraggi nello spazio di Azure) e pulire le risorse Watcher.</span><span class="sxs-lookup"><span data-stu-id="f26c0-239">After locating the Azure Spatial Anchor, call **Stop Watcher** to stop the Azure Spatial Anchors Watcher and clean up watcher resources.</span></span>

![Progetto della funzione di arresto del watcher chiamata](images/asa-unreal/unreal-spatial-anchors-img-22.png)

<span data-ttu-id="f26c0-241">Il progetto Event Graph (Grafico eventi) finale dovrebbe ora avere un aspetto simile allo screenshot seguente:</span><span class="sxs-lookup"><span data-stu-id="f26c0-241">Your final Event Graph blueprint should now look like the screenshot below:</span></span>

![Progetto del grafico eventi completo per la gestione degli eventi del delegato degli ancoraggi](images/asa-unreal/unreal-spatial-anchors-img-23.png)

## <a name="next-development-checkpoint"></a><span data-ttu-id="f26c0-243">Successivo checkpoint di sviluppo</span><span class="sxs-lookup"><span data-stu-id="f26c0-243">Next Development Checkpoint</span></span>

<span data-ttu-id="f26c0-244">Se si segue il percorso delineato per lo sviluppo con Unreal, tenere presente che si stanno esplorando i blocchi predefiniti fondamentali di MRTK.</span><span class="sxs-lookup"><span data-stu-id="f26c0-244">If you're following the Unreal development journey we've laid out, you're in the midst of exploring the MRTK core building blocks.</span></span> <span data-ttu-id="f26c0-245">Da qui è possibile passare al blocco predefinito successivo:</span><span class="sxs-lookup"><span data-stu-id="f26c0-245">From here, you can continue to the next building block:</span></span> 

> [!div class="nextstepaction"]
> [<span data-ttu-id="f26c0-246">Mapping spaziale</span><span class="sxs-lookup"><span data-stu-id="f26c0-246">Spatial mapping</span></span>](unreal-spatial-mapping.md)

<span data-ttu-id="f26c0-247">In alternativa, passare alle API e alle funzionalità della piattaforma di realtà mista:</span><span class="sxs-lookup"><span data-stu-id="f26c0-247">Or jump to Mixed Reality platform capabilities and APIs:</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="f26c0-248">Fotocamera HoloLens</span><span class="sxs-lookup"><span data-stu-id="f26c0-248">HoloLens camera</span></span>](unreal-hololens-camera.md)

<span data-ttu-id="f26c0-249">È sempre possibile tornare ai [checkpoint per lo sviluppo con Unreal](unreal-development-overview.md#2-core-building-blocks) in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="f26c0-249">You can always go back to the [Unreal development checkpoints](unreal-development-overview.md#2-core-building-blocks) at any time.</span></span>


## <a name="next-steps"></a><span data-ttu-id="f26c0-250">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="f26c0-250">Next steps</span></span>
* [<span data-ttu-id="f26c0-251">Ancoraggi nello spazio locali</span><span class="sxs-lookup"><span data-stu-id="f26c0-251">Local Spatial Anchors</span></span>](unreal-spatial-anchors.md)
* [<span data-ttu-id="f26c0-252">Documentazione di Ancoraggi nello spazio</span><span class="sxs-lookup"><span data-stu-id="f26c0-252">Spatial Anchors documentation</span></span>](/azure/spatial-anchors/)
* [<span data-ttu-id="f26c0-253">Funzionalità di Ancoraggi nello spazio</span><span class="sxs-lookup"><span data-stu-id="f26c0-253">Spatial Anchor features</span></span>](https://azure.microsoft.com/services/spatial-anchors/#features)
* [<span data-ttu-id="f26c0-254">Linee guida per un'esperienza efficace di gestione degli ancoraggi</span><span class="sxs-lookup"><span data-stu-id="f26c0-254">Effective anchor experience guidelines</span></span>](/azure/spatial-anchors/concepts/guidelines-effective-anchor-experiences)