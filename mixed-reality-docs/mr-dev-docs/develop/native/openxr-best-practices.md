---
title: Procedure consigliate per OpenXR
description: Informazioni sulle procedure consigliate per qualità visiva, stabilità e prestazioni per le applicazioni OpenXR.
author: thetuvix
ms.author: alexturn
ms.date: 2/28/2020
ms.topic: article
keywords: OpenXR, Khronos, BasicXRApp, DirectX, nativo, app nativa, motore personalizzato, middleware, procedure consigliate, prestazioni, qualità, stabilità
ms.openlocfilehash: ee600cfc22ab1fb7ee43c5727d8e19cf3a1b1463
ms.sourcegitcommit: 2bf79eef6a9b845494484f458443ef4f89d7efc0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/17/2020
ms.locfileid: "97612985"
---
# <a name="openxr-app-best-practices"></a><span data-ttu-id="07569-104">Procedure consigliate per le app OpenXR</span><span class="sxs-lookup"><span data-stu-id="07569-104">OpenXR app best practices</span></span>

<span data-ttu-id="07569-105">È possibile vedere un esempio delle procedure consigliate riportate di seguito nel file OpenXRProgram. cpp di <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>.</span><span class="sxs-lookup"><span data-stu-id="07569-105">You can see an example of the best practices below in <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>'s OpenXRProgram.cpp file.</span></span> <span data-ttu-id="07569-106">La funzione Run () all'inizio acquisisce un flusso di codice dell'app OpenXR tipico dall'inizializzazione all'evento e al ciclo di rendering.</span><span class="sxs-lookup"><span data-stu-id="07569-106">The Run() function at the beginning captures a typical OpenXR app code flow from initialization to the event and rendering loop.</span></span>

## <a name="best-practices-for-visual-quality-and-stability"></a><span data-ttu-id="07569-107">Procedure consigliate per la qualità e la stabilità visive</span><span class="sxs-lookup"><span data-stu-id="07569-107">Best practices for visual quality and stability</span></span>

<span data-ttu-id="07569-108">Le procedure consigliate in questa sezione descrivono come ottenere la qualità visiva e la stabilità migliori in qualsiasi applicazione OpenXR.</span><span class="sxs-lookup"><span data-stu-id="07569-108">The best practices in this section describe how to get the best visual quality and stability in any OpenXR application.</span></span>

<span data-ttu-id="07569-109">Per ulteriori raccomandazioni sulle prestazioni specifiche per HoloLens 2, vedere la sezione procedure consigliate [per le prestazioni in HoloLens 2](#best-practices-for-performance-on-hololens-2) .</span><span class="sxs-lookup"><span data-stu-id="07569-109">For further performance recommendations specific to HoloLens 2, see the [Best practices for performance on HoloLens 2](#best-practices-for-performance-on-hololens-2) section below.</span></span>

### <a name="gamma-correct-rendering"></a><span data-ttu-id="07569-110">Rendering con correzione gamma</span><span class="sxs-lookup"><span data-stu-id="07569-110">Gamma-correct rendering</span></span>

<span data-ttu-id="07569-111">È necessario prestare attenzione per assicurarsi che la pipeline di rendering sia corretta da gamma.</span><span class="sxs-lookup"><span data-stu-id="07569-111">Care must be taken to ensure that your rendering pipeline is gamma-correct.</span></span> <span data-ttu-id="07569-112">Quando si esegue il rendering in un presentazione catena, il formato di visualizzazione della destinazione di rendering deve corrispondere al formato presentazione catena.</span><span class="sxs-lookup"><span data-stu-id="07569-112">When rendering to a swapchain, the render-target view format should match the swapchain format.</span></span> <span data-ttu-id="07569-113">Ad esempio, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` sia per il formato presentazione catena che per la visualizzazione di destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="07569-113">For example, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` for both the swapchain format and the render-target view.</span></span>
<span data-ttu-id="07569-114">Si verifica un'eccezione se la pipeline di rendering dell'app esegue una conversione di sRGB manuale nel codice dello shader.</span><span class="sxs-lookup"><span data-stu-id="07569-114">There's an exception if the app's rendering pipeline does a manual sRGB conversion in shader code.</span></span> <span data-ttu-id="07569-115">L'app deve richiedere un formato presentazione catena di sRGB, ma usare il formato lineare per la visualizzazione di destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="07569-115">The app should request an sRGB swapchain format but use the linear format for the render-target view.</span></span> <span data-ttu-id="07569-116">Ad esempio, richiedere `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` come formato presentazione catena ma usare `DXGI_FORMAT_B8G8R8A8_UNORM` come visualizzazione di destinazione di rendering per impedire che il contenuto venga corretto a seconda della gamma.</span><span class="sxs-lookup"><span data-stu-id="07569-116">For example, request `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` as the swapchain format but use `DXGI_FORMAT_B8G8R8A8_UNORM` as the render-target view to prevent content from being double-gamma corrected.</span></span>

### <a name="submit-depth-buffer-for-projection-layers"></a><span data-ttu-id="07569-117">Invia buffer di profondità per i livelli di proiezione</span><span class="sxs-lookup"><span data-stu-id="07569-117">Submit depth buffer for projection layers</span></span>

<span data-ttu-id="07569-118">Usare sempre `XR_KHR_composition_layer_depth` Extension e inviare il buffer di profondità insieme al livello di proiezione quando si invia un frame a `xrEndFrame` .</span><span class="sxs-lookup"><span data-stu-id="07569-118">Always use `XR_KHR_composition_layer_depth` extension and submit the depth buffer together with the projection layer when submitting a frame to `xrEndFrame`.</span></span>
<span data-ttu-id="07569-119">L'abilitazione della riproiezione hardware depth in HoloLens 2 migliora la stabilità degli ologrammi.</span><span class="sxs-lookup"><span data-stu-id="07569-119">Enabling hardware depth reprojection on HoloLens 2 improves hologram stability.</span></span>

### <a name="choose-a-reasonable-depth-range"></a><span data-ttu-id="07569-120">Scegliere un intervallo di profondità ragionevole</span><span class="sxs-lookup"><span data-stu-id="07569-120">Choose a reasonable depth range</span></span>

<span data-ttu-id="07569-121">Preferire un intervallo di profondità più ristretto per definire l'ambito del contenuto virtuale per aiutare la stabilità degli ologrammi in HoloLens.</span><span class="sxs-lookup"><span data-stu-id="07569-121">Prefer a narrower depth range to scope the virtual content to help hologram stability on HoloLens.</span></span>
<span data-ttu-id="07569-122">Ad esempio, l'esempio OpenXrProgram. cpp USA 0,1 metri per 20 metri.</span><span class="sxs-lookup"><span data-stu-id="07569-122">For example, the OpenXrProgram.cpp sample is using 0.1 meters to 20 meters.</span></span>
<span data-ttu-id="07569-123">Utilizzare [invertito-Z](https://developer.nvidia.com/content/depth-precision-visualized) per una risoluzione più uniforme della profondità.</span><span class="sxs-lookup"><span data-stu-id="07569-123">Use [reversed-Z](https://developer.nvidia.com/content/depth-precision-visualized) for a more uniform depth resolution.</span></span>
<span data-ttu-id="07569-124">In HoloLens 2, l'uso del `DXGI_FORMAT_D16_UNORM` formato di profondità preferito consentirà di ottimizzare la frequenza dei fotogrammi e le prestazioni, sebbene i buffer di profondità a 16 bit forniscano una risoluzione inferiore ai buffer di profondità a 24 bit.</span><span class="sxs-lookup"><span data-stu-id="07569-124">On HoloLens 2, using the preferred `DXGI_FORMAT_D16_UNORM` depth format will help achieve better frame rate and performance, although 16-bit depth buffers provide less depth resolution than 24-bit depth buffers.</span></span>
<span data-ttu-id="07569-125">Seguire queste procedure consigliate per sfruttare al meglio la risoluzione di profondità diventa più importante.</span><span class="sxs-lookup"><span data-stu-id="07569-125">Following these best practices to make best use of the depth resolution becomes more important.</span></span>

### <a name="prepare-for-different-environment-blend-modes"></a><span data-ttu-id="07569-126">Preparare le diverse modalità di Blend dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="07569-126">Prepare for different environment blend modes</span></span>

<span data-ttu-id="07569-127">Se l'applicazione verrà eseguita anche su auricolari immersivi che bloccano completamente il mondo, assicurarsi di enumerare le modalità di Blend dell'ambiente supportate usando l' `xrEnumerateEnvironmentBlendModes` API e preparare correttamente il contenuto di rendering.</span><span class="sxs-lookup"><span data-stu-id="07569-127">If your application will also run on immersive headsets that completely block out the world, be sure to enumerate supported environment blend modes using `xrEnumerateEnvironmentBlendModes` API, and prepare your rendering content correctly.</span></span>
<span data-ttu-id="07569-128">Ad esempio, per un sistema con come `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` HoloLens, l'app deve usare trasparente come colore chiaro, mentre per un sistema con `XR_ENVIRONMENT_BLEND_MODE_OPAQUE` , l'app deve eseguire il rendering di un colore opaco o di una stanza virtuale in background.</span><span class="sxs-lookup"><span data-stu-id="07569-128">For example, for a system with `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` such as the HoloLens, the app should use transparent as the clear color, while for a system with `XR_ENVIRONMENT_BLEND_MODE_OPAQUE`, the app should render some opaque color or some virtual room in the background.</span></span>

### <a name="choose-unbounded-reference-space-as-applications-root-space"></a><span data-ttu-id="07569-129">Scegliere lo spazio di riferimento senza limiti come spazio radice dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="07569-129">Choose unbounded reference space as application's root space</span></span>

<span data-ttu-id="07569-130">In genere, le applicazioni stabiliscono uno spazio delle coordinate del mondo radice per connettere viste, azioni e ologrammi.</span><span class="sxs-lookup"><span data-stu-id="07569-130">Applications typically establish some root world coordinate space to connect views, actions, and holograms together.</span></span>
<span data-ttu-id="07569-131">Usare `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` quando l'estensione è supportata per stabilire un [sistema di coordinate su scala globale](../../design/coordinate-systems.md#building-a-world-scale-experience), consentendo all'app di evitare la tendenza olografica indesiderata quando l'utente si sposta per la prima volta, ad esempio 5 metri di distanza, da dove viene avviata l'app.</span><span class="sxs-lookup"><span data-stu-id="07569-131">Use `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` when the extension is supported to establish a [world-scale coordinate system](../../design/coordinate-systems.md#building-a-world-scale-experience), enabling your app to avoid undesired hologram drift when the user moves far (for example, 5 meters away) from where the app starts.</span></span>
<span data-ttu-id="07569-132">Utilizzare `XR_REFERENCE_SPACE_TYPE_LOCAL` come fallback se l'estensione dello spazio non associato non esiste.</span><span class="sxs-lookup"><span data-stu-id="07569-132">Use `XR_REFERENCE_SPACE_TYPE_LOCAL` as a fallback if the unbounded space extension doesn't exist.</span></span>

### <a name="associate-hologram-with-spatial-anchor"></a><span data-ttu-id="07569-133">Associa ologramma a ancoraggio spaziale</span><span class="sxs-lookup"><span data-stu-id="07569-133">Associate hologram with spatial anchor</span></span>

<span data-ttu-id="07569-134">Quando si usa uno spazio di riferimento non vincolato, gli ologrammi posizionati direttamente nello spazio di riferimento [potrebbero andare alla deriva quando l'utente passa a una stanza lontana e quindi](../../design/coordinate-systems.md#building-a-world-scale-experience)torna.</span><span class="sxs-lookup"><span data-stu-id="07569-134">When using an unbounded reference space, holograms you place directly in that reference space [may drift as the user walks to distant rooms and then comes back](../../design/coordinate-systems.md#building-a-world-scale-experience).</span></span>
<span data-ttu-id="07569-135">Per gli utenti olografici posizionati in una posizione discreta nel mondo, [creare un ancoraggio spaziale](../../design/spatial-anchors.md#best-practices) usando la `xrCreateSpatialAnchorSpaceMSFT` funzione di estensione e posizionare l'ologramma all'origine.</span><span class="sxs-lookup"><span data-stu-id="07569-135">For hologram users place at a discrete location in the world, [create a spatial anchor](../../design/spatial-anchors.md#best-practices) using the `xrCreateSpatialAnchorSpaceMSFT` extension function and position the hologram at its origin.</span></span> <span data-ttu-id="07569-136">In questo modo l'ologramma viene mantenuto indipendentemente stabile nel tempo.</span><span class="sxs-lookup"><span data-stu-id="07569-136">That will keep that hologram independently stable over time.</span></span>

### <a name="support-mixed-reality-capture"></a><span data-ttu-id="07569-137">Supportare l'acquisizione di realtà mista</span><span class="sxs-lookup"><span data-stu-id="07569-137">Support mixed reality capture</span></span>

<span data-ttu-id="07569-138">Sebbene la visualizzazione principale di HoloLens 2 usi la fusione dell'ambiente additiva, quando l'utente avvia l' [acquisizione della realtà mista](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), il contenuto di rendering dell'app verrà sottoposto ad Alpha blending con il flusso video dell'ambiente.</span><span class="sxs-lookup"><span data-stu-id="07569-138">Although HoloLens 2's primary display uses additive environment blending, when the user starts [mixed reality capture](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), the app's rendering content will be alpha-blended with the environment video stream.</span></span>
<span data-ttu-id="07569-139">Per ottenere la migliore qualità visiva nei video di acquisizione di realtà mista, è preferibile impostare nell'oggetto del `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` livello di proiezione `layerFlags` .</span><span class="sxs-lookup"><span data-stu-id="07569-139">To achieve the best visual quality in mixed reality capture videos, it's best to set the `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` in your projection layer's `layerFlags`.</span></span>

## <a name="best-practices-for-performance-on-hololens-2"></a><span data-ttu-id="07569-140">Procedure consigliate per le prestazioni in HoloLens 2</span><span class="sxs-lookup"><span data-stu-id="07569-140">Best practices for performance on HoloLens 2</span></span>

<span data-ttu-id="07569-141">Come dispositivo mobile con supporto per la riproiezione dell'hardware, HoloLens 2 presenta requisiti più restrittivi per ottenere prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="07569-141">As a mobile device with hardware reprojection support, HoloLens 2 has stricter requirements for optimal performance.</span></span>  <span data-ttu-id="07569-142">Esistono diversi modi per inviare i dati di composizione tramite, il che comporta un notevole calo delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="07569-142">There are a number of ways to submit composition data through, which results in post-processing with a noticeable performance penalty.</span></span>

### <a name="select-a-swapchain-format"></a><span data-ttu-id="07569-143">Selezionare un formato presentazione catena</span><span class="sxs-lookup"><span data-stu-id="07569-143">Select a swapchain format</span></span>

<span data-ttu-id="07569-144">Enumerare sempre i formati di pixel supportati usando `xrEnumerateSwapchainFormats` e scegliere il primo formato pixel di colore e profondità dal runtime supportato dall'app, perché questo è quello che il runtime preferisce per ottenere prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="07569-144">Always enumerate supported pixel formats using `xrEnumerateSwapchainFormats`, and choose the first color and depth pixel format from the runtime that the app supports, because that's what the runtime prefers for optimal performance.</span></span> <span data-ttu-id="07569-145">Si noti che, in HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` ed `DXGI_FORMAT_D16_UNORM` è in genere la prima scelta per ottenere prestazioni di rendering migliori.</span><span class="sxs-lookup"><span data-stu-id="07569-145">Note, on HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` and `DXGI_FORMAT_D16_UNORM` is typically the first choice to achieve better rendering performance.</span></span> <span data-ttu-id="07569-146">Questa preferenza può essere diversa negli auricolari VR in esecuzione su un PC desktop, in cui i buffer di profondità a 24 bit hanno un minore effetto sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="07569-146">This preference can be different on VR headsets running on a Desktop PC, where 24-bit depth buffers have less of a performance impact.</span></span>
  
<span data-ttu-id="07569-147">**Avviso di prestazioni:** L'uso di un formato diverso dal formato di colore presentazione catena primario comporterà la post-elaborazione del runtime, che comporta una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="07569-147">**Performance Warning:** Using a format other than the primary swapchain color format will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="render-with-recommended-rendering-parameters-and-frame-timing"></a><span data-ttu-id="07569-148">Rendering con i parametri di rendering consigliati e la tempistica dei frame</span><span class="sxs-lookup"><span data-stu-id="07569-148">Render with recommended rendering parameters and frame timing</span></span>

<span data-ttu-id="07569-149">Eseguire sempre il rendering con la larghezza/altezza di configurazione della visualizzazione consigliata ( `recommendedImageRectWidth` e `recommendedImageRectHeight` da `XrViewConfigurationView` ) e usare sempre l' `xrLocateViews` API per eseguire una query per la visualizzazione, FOV e altri parametri di rendering consigliati prima del rendering.</span><span class="sxs-lookup"><span data-stu-id="07569-149">Always render with the recommended view configuration width/height (`recommendedImageRectWidth` and `recommendedImageRectHeight` from `XrViewConfigurationView`), and always use `xrLocateViews` API to query for the recommended view pose, FOV, and other rendering parameters before rendering.</span></span>
<span data-ttu-id="07569-150">Usare sempre `XrFrameEndInfo.predictedDisplayTime` dalla chiamata più recente `xrWaitFrame` quando si eseguono query per pose e viste.</span><span class="sxs-lookup"><span data-stu-id="07569-150">Always use the `XrFrameEndInfo.predictedDisplayTime` from the latest `xrWaitFrame` call when querying for poses and views.</span></span>
<span data-ttu-id="07569-151">Ciò consente a HoloLens di modificare il rendering e ottimizzare la qualità visiva per la persona che sta indossando la HoloLens.</span><span class="sxs-lookup"><span data-stu-id="07569-151">This allows HoloLens to adjust rendering and optimize visual quality for the person who is wearing the HoloLens.</span></span>

### <a name="use-a-single-projection-layer"></a><span data-ttu-id="07569-152">Usa un solo livello di proiezione</span><span class="sxs-lookup"><span data-stu-id="07569-152">Use a single projection layer</span></span>

<span data-ttu-id="07569-153">HoloLens 2 ha una potenza GPU limitata per il rendering del contenuto e un compositor hardware ottimizzato per un singolo livello di proiezione.</span><span class="sxs-lookup"><span data-stu-id="07569-153">HoloLens 2 has limited GPU power for rendering content and a hardware compositor optimized for a single projection layer.</span></span>
<span data-ttu-id="07569-154">Usare sempre un solo livello di proiezione può aiutare a framerate, stabilità olografica e qualità visiva dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="07569-154">Always using a single projection layer can help the application's framerate, hologram stability and visual quality.</span></span>  
  
<span data-ttu-id="07569-155">**Avviso di prestazioni:** L'invio di qualsiasi elemento, ma un solo livello di protezione, comporterà la post-elaborazione del runtime, che comporta una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="07569-155">**Performance Warning:** Submitting anything but a single protection layer will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="render-with-texture-array-and-vprt"></a><span data-ttu-id="07569-156">Rendering con matrice di trame e VPRT</span><span class="sxs-lookup"><span data-stu-id="07569-156">Render with texture array and VPRT</span></span>

<span data-ttu-id="07569-157">Crearne uno `xrSwapchain` per gli occhi sinistro e destro usando `arraySize=2` per il colore presentazione catena e uno per la profondità.</span><span class="sxs-lookup"><span data-stu-id="07569-157">Create one `xrSwapchain` for both left and right eye using `arraySize=2` for color swapchain, and one for depth.</span></span>
<span data-ttu-id="07569-158">Eseguire il rendering dell'occhio sinistro nella sezione 0 e l'occhio destro nella sezione 1.</span><span class="sxs-lookup"><span data-stu-id="07569-158">Render the left eye into slice 0 and the right eye into slice 1.</span></span>
<span data-ttu-id="07569-159">Usare uno shader con VPRT e le chiamate di progetto con istanza per il rendering stereoscopico per ridurre al minimo il carico della GPU.</span><span class="sxs-lookup"><span data-stu-id="07569-159">Use a shader with VPRT and instanced draw calls for stereoscopic rendering to minimize GPU load.</span></span>
<span data-ttu-id="07569-160">Questo consente anche l'ottimizzazione del runtime per ottenere prestazioni ottimali in HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="07569-160">This also enables the runtime's optimization to achieve the best performance on HoloLens 2.</span></span>
<span data-ttu-id="07569-161">Le alternative all'uso di una matrice di trame, ad esempio il rendering a doppio livello o un presentazione catena separato per occhio, comporteranno la post-elaborazione del runtime, che comporta una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="07569-161">Alternatives to using a texture array, such as double-wide rendering or a separate swapchain per eye, will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="avoid-quad-layers"></a><span data-ttu-id="07569-162">Evitare i livelli quad</span><span class="sxs-lookup"><span data-stu-id="07569-162">Avoid quad layers</span></span>

<span data-ttu-id="07569-163">Anziché inviare livelli quad come livelli di composizione con `XrCompositionLayerQuad` , eseguire il rendering del contenuto Quad direttamente nella proiezione presentazione catena.</span><span class="sxs-lookup"><span data-stu-id="07569-163">Rather than submitting quad layers as composition layers with `XrCompositionLayerQuad`, render the quad content directly into the projection swapchain.</span></span>

<span data-ttu-id="07569-164">**Avviso di prestazioni:** Fornire livelli aggiuntivi oltre un singolo livello di proiezione, ad esempio i livelli quad, comporterà la post-elaborazione del runtime, che comporta una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="07569-164">**Performance Warning:** Providing additional layers beyond a single projection layer, such as quad layers, will result in runtime post-processing, which comes at a significant performance penalty.</span></span>